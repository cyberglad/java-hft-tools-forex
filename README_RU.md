# Java HFT Tools: Forex Market Simulation

–ü—Ä–æ–µ–∫—Ç-–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º (High-Frequency Trading) –Ω–∞ Java 21. –í–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –ø—Ä–∏–º–µ—Ä—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏, –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∏ —Ä–∞–±–æ—Ç—ã —Å –ë–î.

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

–í –¥–∞–Ω–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –Ω–∞–≥–ª—è–¥–Ω–æ –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –∞—Å–ø–µ–∫—Ç—ã:
1.  **Memory Management**: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π JDK –∏ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã—Ö –∫–∞—Ä—Ç `fastutil`.
2.  **Lock-Free & Optimistic Locking**: –†–∞–±–æ—Ç–∞ —Å `StampedLock`, `VarHandle` –∏ CAS-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏.
3.  **Market Simulation**: –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è —Ü–µ–Ω—ã –≤–∞–ª—é—Ç–Ω—ã—Ö –ø–∞—Ä (Random Walk).
4.  **Database Integrity**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Optimistic –∏ Pessimistic –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ —á–µ—Ä–µ–∑ Hibernate.

---

## üèó –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### 1. Fastutil vs JDK HashMap (`FastMapVsJdkDemo.java`)
–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ **Open Addressing** –Ω–∞–¥ **Chaining**.
* **JDK HashMap**: –°–æ–∑–¥–∞–µ—Ç –º–∏–ª–ª–∏–æ–Ω—ã –æ–±—ä–µ–∫—Ç–æ–≤-–æ–±–µ—Ä—Ç–æ–∫ (`Integer`, `Double`), –ø–µ—Ä–µ–≥—Ä—É–∂–∞—è Garbage Collector.
* **Fastutil Int2DoubleOpenHashMap**: –•—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ø–ª–æ—Ç–Ω—ã—Ö –º–∞—Å—Å–∏–≤–∞—Ö –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤.
* *–†–µ–∑—É–ª—å—Ç–∞—Ç:* –°–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –Ω–∞ ~30% –∏ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤—Å—Ç–∞–≤–æ–∫ –≤ 2-3 —Ä–∞–∑–∞.



### 2. –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–∞—è —Å–∏–º—É–ª—è—Ü–∏—è —Ä—ã–Ω–∫–∞ (`ConcurrentPrimitiveMapDemo.java`)
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∫–æ—Ç–∏—Ä–æ–≤–æ–∫.
* **Provider**: –ò–º–∏—Ç–∏—Ä—É–µ—Ç –º–∞—Ä–∫–µ—Ç-–º–µ–π–∫–µ—Ä–∞, –≥–µ–Ω–µ—Ä–∏—Ä—É—è –Ω–æ–≤—ã–µ —Ü–µ–Ω—ã EUR/USD —Å –ø–æ–º–æ—â—å—é –ì–∞—É—Å—Å–æ–≤—Å–∫–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (–º–µ—Ç–æ–¥ `generateNextPrice`).
* **Consumer**: –†–æ–±–æ—Ç-–∞–ª–≥–æ—Ä–∏—Ç–º, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π **Optimistic Read**.
* **StampedLock**: –ü–æ–∑–≤–æ–ª—è–µ—Ç —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫, –µ—Å–ª–∏ –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç –Ω–µ –∏–¥–µ—Ç –∑–∞–ø–∏—Å—å.



### 3. –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π CAS (`LowLevelCasDemo.java`)
–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `VarHandle` (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–º–µ–Ω–∞ `Unsafe`).
* –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∞—Ç–æ–º–∞—Ä–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–∞—Å—Å–∏–≤–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞.
* –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ü–∏–∫–ª–∞ **Compare-And-Swap** –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –≥–æ–Ω–∫–∏ (Race Condition).

### 4. Hibernate Locking (`HibernateLockDemo.java`)
–ü—Ä–∏–º–µ—Ä—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å—é –≤ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã—Ö –ë–î:
* **Optimistic**: –ß–µ—Ä–µ–∑ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é `@Version`. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏ `UPDATE`.
* **Pessimistic**: –ß–µ—Ä–µ–∑ `LockModeType.PESSIMISTIC_WRITE`. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SQL `SELECT ... FOR UPDATE`.

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

* **Java 21** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `VarHandle` –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∏—à–µ–∫ JVM)
* **Fastutil 8.5.12** ‚Äî –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤.
* **Spring Data JPA / Hibernate 6** ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏.
* **H2 Database** ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤.

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

1.  **–°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞**:
    ```bash
    mvn clean install
    ```

2.  **–ó–∞–ø—É—Å–∫ –±–µ–Ω—á–º–∞—Ä–∫–∞ –ø–∞–º—è—Ç–∏**:
    ```bash
    mvn exec:java -Dexec.mainClass="com.hft.demo.FastMapVsJdkDemo"
    ```

3.  **–ó–∞–ø—É—Å–∫ —Å–∏–º—É–ª—è—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤**:
    ```bash
    mvn exec:java -Dexec.mainClass="com.hft.demo.ConcurrentPrimitiveMapDemo"
    ```

## üìà –°–ø—Ä–∞–≤–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

| –ú–µ—Ç–æ–¥ | –ü–ª—é—Å—ã | –ú–∏–Ω—É—Å—ã |
| :--- | :--- | :--- |
| **Pessimistic Locking** | 100% –∑–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ | –ù–∏–∑–∫–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å |
| **Optimistic Locking** | –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å | –ù—É–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å Retries –ø—Ä–∏ –∫–æ–ª–ª–∏–∑–∏—è—Ö |
| **Open Addressing** | CPU Cache Friendly | –¢—Ä–µ–±—É–µ—Ç —Ä–µ—Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ > 70% |

---

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è
–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—è—Ö –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ High Performance Java.~~~~